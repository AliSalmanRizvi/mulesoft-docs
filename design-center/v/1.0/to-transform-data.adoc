= To Transform Data
:keywords:


== Overview


In the *Transform* card, you can dynamically generate mappings through DataWeave, MuleSoft's most powerful and versatile tool for transforming data. The Transform component carries out a transformation of your Mule message that follows a transformation script, this script is implicitly built through dragging and dropping elements using a simple interface. You also have access to edit this script directly, in case you want to link:/mule-user-guide/v/3.8/dataweave-language-introduction[explicitly write in DataWeave code].

image:


[TIP]
====
You can unleash the full power of the DataWeave language by writing scripts directly in the text editor, to learn about its possibilities and syntax see link:/mule-user-guide/v/3.8/dataweave-language-introduction[DataWeave language Introduction].
====


If you click on an instance of the *Transform* card in your flow, its properties editor are displayed:

image:[new weave]

In the default view of the properties editor there are two main regions:

* *On the left*: is the graphical UI, which exposes the known input and output structures. The mappings between input and output fields are represented through tubes and regions that join both sides. You can easily drag one field onto another to map them together, other ways to interact with this UI are described in <<The Mapping View>>.
* *On the right*: Is the output preview. Here you can see what your output data would look like after being affected by the component's transformation. This output is constructed based on sample data and is updated in real time as you make changes to your script or to your sample, so that you can be sure of what you'll be getting out of the other end.

image:  (showing left and right )

Note that in the lower margin of the editor, there are three tabs you can click to select the view:

* the *Mappings* view is the default view described above, which lets you drag and drop elements to create transformations.
* the *Sample Data* view allows you to provide input examples, which are then processed in real time to produce output previews.
* the *Source* view lets you edit the DataWeave code that carries out the transformation.


== The Mappings View

image:[ui]

This is the default view that is displayed when you open this card. Through this view, you can easily map input fields onto output fields through intuitive simple interactions. Two tree views show the known metadata contents of the expected incoming messages and the required outgoing messages, allowing you to explore their structure.

Here some of the most common things you can do through the UI:


* Drag an element on the input structure over to another on the output structure. This will cast an arrow that joins them in the UI, representing that when your transformation is executed, the output field takes the value of the input field.
+
image:

* Drag a high-level object that contains child elements onto another in the output. This mapping is represented by a shaded region, and when your transformation is executed, all child elements in the input are passed on to the output. If you drag an array, a link:/mule-user-guide/v/4.0/dataweave-operators#map['map'] operation loops through every item in the array.
+
image:


* Click on the trash-can icon of an existing tube or joining region to remove it.

image:

* Double click on an output field to edit it. You can assign it a static value, or write a function that might involve one or more of the input fields. To populate a field with a function, double click on it and a window will open where you can write freely. This experience relates to that of using a spreadsheet, where each field might be a direct reference to another, or might be the product of a function that involves such references. When a function or static value exists on a field, this is represented by an `f(x)` icon next to it.
+
image:[click]
+
These functions can also be removed by clicking on the trash-can icons on them.

////
* Filter the views displayed in the input and output structures by typing a name in the search boxes at the top of either, only those fields that match your search are then displayed. This is particularly useful when dealing with large data structures with many nested elements.
////




=== Defining Data Shape


You should have both the known input and the expected output as already defined before you deal with the Transform card, to learn how to provide this information, see link:/design-center/v/1.0/to-handle-data-shapes[To Handle Data Shapes].

If the data shape definition is missing for the input or output, a notification on the corresponding section of the Graphical UI will advise you to provide it.


There are several ways in which you can provide this information. See link:/design-center/v/1.0/to-handle-data-shapes#data-types-in-the-transform-card[Data Types in the Transform Card] for details on how to do this.

Once defined, this metadata is displayed in the input or output structures in the UI.

image:to-transform-data-da5b0.png[]



[NOTE]
====
If you plan to create your transform entirely via the <<The DataWeave Text Editor, text editor section>>, you can skip specifying the metadata definition and reference elements directly via code. See link:/mule-user-guide/v/4.0/dataweave-language-introduction[DataWeave] to get familiar with the scripting language.

Defining metadata is still advisable, as it feeds into the autocomplete options when writing code.
====



== The Sample Data View


The sample data view allows you to test out examples of what your input might look like. This sample data is used together with your DataWeave code to produce a sample output in <<The Preview Section>>, which gets updated in real time as you make changes. Through this, you can make sure that your transformation deals well with different use cases, special characters, etc.

This sample data can be obtained from the metadata exposed by other elements on the flow, it can otherwise be manually provided by typing it into the sample data tab.


[NOTE]
Note that samples defined in this section work within the scope of the *Transform* card, they don't alter the metadata that's propagated to other elements in the flow, and their values aren't propagated onwards. They aren't used in run time in any way, not as default values nor anything else, they're only used in design time.


image:[sample data]


[NOTE]
When the input is of types JSON, XML, or CSV, the sample input contains plain code in the corresponding format. When the input is of type POJO, it's expressed in JSON format.

Note that the sample data view only displays the contents of one of the parts of the Mule message (eg: the payload, or one of the variables). You can choose to view and edit different parts of the input by clicking on different parts of the input structure to select them.

image:




== The Source View

image:[code]

In this section, you write the actual link:/mule-user-guide/v/3.8/dataweave-language-introduction[DataWeave] code that carries out the transform. Sometimes, all you need to do can be automatically built by dragging elements in the GUI, but other times you may want to carry out more complex operations that involve aggregation, filtering, calculations, defining custom functions, etc... and for that you must write DataWeave code.

By editing the code directly you can leverage the full power of DataWeave syntax. See the link:/mule-user-guide/v/3.8/dataweave-language-introduction[DataWeave language introduction] for a guide on the DataWeave language syntax.


== The Preview Section


This section, always displayed on the right of the properties editor, presents a sample output, built by taking the sample input you provide in <<The Sample Data View, the sample data view>> and transforming it through the DataWeave transformation. As you make any changes to the transformation or the sample, notice how the output data structure changes in real time.

This panel assures you that the output produced by your transformation is what you expect. This can sometimes get tricky when you're dealing with arrays of objects and such or with special characters, so it's always good to know your output well.

[NOTE]
If your transformer has <<handling multiple outputs, multiple outputs>>, the *Preview* section displays only the one corresponding to the currently selected output target.

image:[preview]

If no sample is provided yet, this section features a shortcut that you can click to open the <<provide input sample data,*Edit Sample*>> window and provide an input sample to construct the preview.

image:[shortuct]

If you still haven't set up the metadata structure for your input, when clicking on this shortcut you will be first prompted to set up the structure via the <<Defining Input and Output Structure>> window.


== Viewing Errors

Any syntax errors on your DataWeave code are marked in red notes over the *Preview Section*.

image:

On the *Source* tab, an additional error notification marks the ammount of errors present.


image:[errors]


////
== Reader Configuration

As part of the metadata definition of your input structure, DataWeave allows you to set up certain properties of the reader object so that it parses the input differently. This is only available with certain inptut formats, and each one of these has its own specific properties. In Anypoint Studio, there are two ways to set this up:

* Configure the component that actually brings this information into your flow, by accessing its link:/mule-user-guide/v/3.8/custom-metadata-tab[*Metadata* tab].

* On the Transform Message component itself, right clicking on the root of the input section and selecting *Reader Configuration* to access a menu
+
image:dw_reader_configuration_select.png[reader conf]

+
[NOTE]
This option won't be available if the type of the input doesn't allow for this kind of configuration. If the payload is of type `unknown`, you must change its type first.




For a detailed reference of what properties can be set in the Reader Configuration of each format, see the corresponding *reader properties* section:

* link:/mule-user-guide/v/3.8/dataweave-formats#csv[CSV]

* link:/mule-user-guide/v/3.8/dataweave-formats#xml[XML]

* link:/mule-user-guide/v/3.8/dataweave-formats#flat-file[Flat File]
////

////
== Writer Configuration

s part of the metadata definition of your output structure, DataWeave allows you to set up certain properties of the writer object so that it constructs the output differently. This is only available with certain output formats, and each one of these has its own specific properties.

These properties are simply written on the `%output` directive of your DataWeave code.

For a detailed reference of what properties can be set in the Writer Configuration of each format, see the corresponding *reader properties* section:

* link:/mule-user-guide/v/3.8/dataweave-formats#csv[CSV]

* link:/mule-user-guide/v/3.8/dataweave-formats#xml[XML]

* link:/mule-user-guide/v/3.8/dataweave-formats#json[JSON]

* link:/mule-user-guide/v/3.8/dataweave-formats#flat-file[Flat File]
////

== Handling Multiple Outputs

A single Transform Message element can give shape to several different parts of the output link:/mule-user-guide/v/4.0/mule-message[Mule message]. For example in one tab you may be defining the payload contents, in another those of an variable, and these will both be parts of the same output Mule message.

To add a new output, simply:

. Go to the *Mappings* tab
. Click on the title of the output section
+
image:
. In the dropdown menu Select *Add transformation*

image:


+
[TIP]
From this same menu you can also delete targets, or open specific ones.


. Then you must specify where in the output Mule message to place the output of this new DataWeave transform.


image:


[NOTE]
====
In case you're using DW through the Map button, the target is already implicitly the field on which you are editing.

Note that by changing the target, the editor displays a different DataWeave script, and preview section, corresponding to the selected target.
====





////
You can also change the target of an existing transform by clicking the *Edit Current Target* button, and in that way point the output of your transform to a different element in the outgoing Mule Message.

image:dw_multiple_outputs_edit.png[edit target]
////
